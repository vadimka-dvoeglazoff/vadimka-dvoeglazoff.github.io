---
layout: post
title: Laravel Queues/Jobs (Очереди)
tags: [Laravel]
comments: false
author: Вадим Двоеглазов
---

Для выполнения длительных операций в Laravel можно воспользоваться механизмом очередей. Для реализации механизма очередей понадобится:

- Миграция для создания **jobs** таблицы
- Миграция для создания **failed_jobs** таблицы
- Класс задания(ний)

Миграции для создания **jobs** таблицы по умолчанию нет в Laravel.
Чтобы создать миграцию необходимо выпонить в терминале команду:

`php artisan queue:table`

Миграция для создания **failed_jobs** таблицы обычно уже присутствует в новых приложениях Laravel. Однако, если приложение не содержит миграции для этой таблицы, для создания можно использовать команду:

`php artisan queue:failed-table`

Для создания таблиц **jobs** и **failed_jobs** в БД необходимо выполнить миграцию, команда:

`php artisan migrate`

Также не забываем указать своему приложению использовать database драйвер, обновив QUEUE_CONNECTION переменную в .env файле приложения:

`QUEUE_CONNECTION=database`

Далее генерируем класс задания, к примеру, SendNotificationAllUsersJob, который будет выполняться асинхронно. Для генерации используем команду:

`php artisan make:job SendNotificationAllUsersJob`

Запустить рабочий процесс можно с помощью команды:

`php artisan queue:work `

Но чтобы queue:work процесс постоянно выполнялся в фоновом режиме, необходимо использовать монитор процесса, такой как **Supervisor**, чтобы гарантировать, что рабочий процесс очереди не прекратит свою работу.

Если задача не может быть выполнена из-за какой-либо ошибки, такая задача перемещается из таблицы **jobs** в таблицу **failed_jobs**. Посмотреть такие задачи можно выполнив команду:

`php artisan queue:failed`

Для повторного запуска задач из таблицы **failed_jobs** необходимо выполнить команду:

`php artisan queue:retry ID`, где ID - идентификатор задачи в таблице **failed_jobs**

Для гарантированного
